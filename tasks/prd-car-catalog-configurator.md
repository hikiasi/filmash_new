# Product Requirements Document: Каталог автомобилей с конфигуратором

## 1. Introduction/Overview

### Описание проекта
Разработка интерактивного каталога автомобилей с встроенным конфигуратором для компании Филмаш — компании по привозу новых автомобилей из разных стран в Россию (Китай, Корея, Япония, США, Европа).

### Проблема
Текущая реализация каталога на сайте https://filmash.ru/catalog имеет следующие недостатки:
- Перегруженные карточки автомобилей с избыточной информацией
- Недостаточно интуитивный конфигуратор
- Отсутствие визуальной обратной связи при изменении параметров
- Сложность быстрой оценки основных характеристик автомобиля

### Цель
Создать современный, интуитивный каталог с визуальным конфигуратором, который позволит пользователям:
- Быстро находить интересующие автомобили через фильтры
- Визуально настраивать комплектацию автомобиля с мгновенной обратной связью
- Видеть итоговую стоимость в рублях и юанях одновременно
- Оформлять заявку с полной информацией о выбранной конфигурации

## 2. Goals

1. **Улучшить UX просмотра каталога**: снизить когнитивную нагрузку за счет отображения только ключевой информации на карточках
2. **Создать интерактивный конфигуратор**: обеспечить визуальную настройку автомобиля с мгновенным обновлением изображений
3. **Повысить конверсию в заявки**: упростить процесс оформления заявки и сохранить всю информацию о конфигурации
4. **Обеспечить масштабируемость**: создать гибкую систему управления данными через PostgreSQL
5. **Подготовить основу для CRM**: структурировать данные заявок для последующей интеграции с админ-панелью

## 3. User Stories

### US-1: Просмотр каталога
**Как** автолюбитель  
**Я хочу** видеть компактные карточки автомобилей с ключевой информацией  
**Чтобы** быстро оценить варианты без перегрузки деталями

**Критерии приемки:**
- Карточка содержит: фото, название модели, цену от, год, мощность, разгон, тип двигателя
- Цена отображается одновременно в рублях и юанях
- Дизайн карточки чистый и минималистичный

### US-2: Фильтрация автомобилей
**Как** покупатель  
**Я хочу** фильтровать автомобили по различным параметрам  
**Чтобы** быстро найти подходящий вариант под мои требования

**Критерии приемки:**
- Доступны фильтры: марка, тип кузова, диапазон цен, мощность, привод, тип двигателя (электро/бензин/гибрид)
- Фильтры применяются мгновенно без перезагрузки страницы
- Количество результатов отображается динамически

### US-3: Конфигурирование автомобиля
**Как** потенциальный покупатель  
**Я хочу** визуально настраивать автомобиль (комплектация, цвет, диски, интерьер)  
**Чтобы** увидеть как будет выглядеть моя конфигурация и узнать итоговую стоимость

**Критерии приемки:**
- При выборе модификации (L7 Pro, L7 Max, L7 Ultra) меняется цена и изображение
- При смене цвета кузова обновляется фото экстерьера
- При смене дисков обновляется фото экстерьера
- При смене интерьера обновляется фото салона
- Все изменения происходят с плавной анимацией (Framer Motion)
- Цена пересчитывается автоматически при добавлении платных опций

### US-4: Просмотр технических характеристик
**Как** автолюбитель  
**Я хочу** видеть полные технические характеристики в конфигураторе  
**Чтобы** принять обоснованное решение о покупке

**Критерии приемки:**
- Отображаются все технические данные выбранной модификации
- Характеристики обновляются при смене модификации
- Данные структурированы и легко читаются

### US-5: Оформление заявки
**Как** заинтересованный покупатель  
**Я хочу** оставить заявку с выбранной конфигурацией  
**Чтобы** менеджер связался со мной и обсудил детали

**Критерии приемки:**
- Форма содержит поля: имя, телефон (с международной валидацией), email
- При отправке сохраняется полная конфигурация (модель, модификация, цвет, диски, интерьер, опции)
- Пользователь получает подтверждение на email
- Менеджеры получают уведомление о новой заявке
- Заявка сохраняется в БД со статусом "Новая"

### US-6: Просмотр сохраненной конфигурации (CRM)
**Как** менеджер  
**Я хочу** открыть заявку и увидеть визуально выбранную клиентом конфигурацию  
**Чтобы** точно понимать какой автомобиль интересует клиента

**Критерии приемки:**
- В CRM есть кнопка "Просмотр конфигурации"
- Открывается модальное окно с визуализацией конфигурации как у клиента
- Видны все выбранные опции и итоговая цена

## 4. Functional Requirements

### FR-1: Структура данных и база данных

#### FR-1.1: Иерархия автомобилей
Система должна поддерживать трехуровневую иерархию:
- **Марка (Brand)**: Lixiang, BYD, Tesla и т.д.
- **Модель (Model)**: L7, L6, L9, Mega Ultra и т.д.
- **Модификация (Trim)**: L7 Pro, L7 Max, L7 Ultra

#### FR-1.2: Таблицы базы данных PostgreSQL
Система должна включать следующие основные таблицы:

**brands** (марки):
- id (UUID, PK)
- name (VARCHAR) - название марки
- logo_url (VARCHAR) - путь к логотипу
- country_of_origin (VARCHAR) - страна происхождения
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)

**models** (модели):
- id (UUID, PK)
- brand_id (UUID, FK → brands.id)
- name (VARCHAR) - название модели (L7, L6)
- body_type (VARCHAR) - тип кузова (седан, кроссовер, внедорожник)
- year (INTEGER) - год выпуска
- description (TEXT)
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)

**trims** (модификации):
- id (UUID, PK)
- model_id (UUID, FK → models.id)
- name (VARCHAR) - название модификации (Pro, Max, Ultra)
- base_price_cny (DECIMAL) - базовая цена в юанях
- base_price_rub (DECIMAL) - базовая цена в рублях
- specifications (JSONB) - технические характеристики
  ```json
  {
    "power": "544 л.с.",
    "acceleration": "4.3 сек",
    "engine_type": "электро",
    "drive_type": "полный",
    "battery": "100 кВт⋅ч",
    "range": "520 км",
    "dimensions": "5050/1995/1750 мм",
    "weight": "2500 кг"
  }
  ```
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)

**colors** (цвета кузова):
- id (UUID, PK)
- trim_id (UUID, FK → trims.id)
- name (VARCHAR) - название цвета
- hex_code (VARCHAR) - HEX код цвета для превью
- image_url (VARCHAR) - путь к фото автомобиля в этом цвете
- is_premium (BOOLEAN) - премиум цвет (может влиять на цену)
- additional_price_cny (DECIMAL, nullable)
- additional_price_rub (DECIMAL, nullable)
- created_at (TIMESTAMP)

**wheels** (диски):
- id (UUID, PK)
- trim_id (UUID, FK → trims.id)
- name (VARCHAR) - название дисков
- size (VARCHAR) - размер дисков (19", 20")
- image_url (VARCHAR) - путь к фото автомобиля с этими дисками
- additional_price_cny (DECIMAL, nullable)
- additional_price_rub (DECIMAL, nullable)
- created_at (TIMESTAMP)

**interiors** (интерьеры):
- id (UUID, PK)
- trim_id (UUID, FK → trims.id)
- name (VARCHAR) - название интерьера/цвета салона
- material (VARCHAR) - материал (кожа, алькантара)
- image_url (VARCHAR) - путь к фото салона
- additional_price_cny (DECIMAL, nullable)
- additional_price_rub (DECIMAL, nullable)
- created_at (TIMESTAMP)

**additional_options** (дополнительные опции):
- id (UUID, PK)
- trim_id (UUID, FK → trims.id)
- name (VARCHAR) - название опции
- description (TEXT) - описание
- is_paid (BOOLEAN) - платная ли опция
- price_cny (DECIMAL, nullable)
- price_rub (DECIMAL, nullable)
- category (VARCHAR) - категория (безопасность, комфорт, технологии)
- created_at (TIMESTAMP)

**inquiries** (заявки):
- id (UUID, PK)
- trim_id (UUID, FK → trims.id)
- color_id (UUID, FK → colors.id)
- wheels_id (UUID, FK → wheels.id, nullable)
- interior_id (UUID, FK → interiors.id, nullable)
- selected_options (JSONB) - массив ID выбранных доп. опций
- customer_name (VARCHAR)
- customer_phone (VARCHAR)
- customer_email (VARCHAR)
- total_price_cny (DECIMAL) - итоговая цена в юанях
- total_price_rub (DECIMAL) - итоговая цена в рублях
- status (ENUM: 'new', 'in_progress', 'completed', 'cancelled')
- configuration_snapshot (JSONB) - полный снимок конфигурации для визуализации
- notes (TEXT, nullable) - комментарии менеджера
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)

**currency_rates** (курсы валют):
- id (UUID, PK)
- rate_cny_to_rub (DECIMAL) - курс юаня к рублю
- source (VARCHAR) - источник курса (API, manual)
- is_manual_override (BOOLEAN) - ручная корректировка
- valid_from (TIMESTAMP)
- created_at (TIMESTAMP)

#### FR-1.3: Хранение изображений
Изображения должны загружаться на сервер и храниться в файловой системе с путями в БД.
- Структура папок: `/public/uploads/cars/{brand_id}/{model_id}/{trim_id}/{type}/`
- Типы: `colors/`, `wheels/`, `interiors/`
- Формат имен файлов: `{uuid}.webp` или `{uuid}.jpg`

### FR-2: Каталог автомобилей

#### FR-2.1: Отображение карточек
Каждая карточка автомобиля в каталоге должна содержать:
- Основное изображение автомобиля (первый цвет первой модификации)
- Название: "{Марка} {Модель}" (например, "Lixiang L7")
- Цена от: отображается минимальная цена среди всех модификаций одновременно в рублях и юанях
- Год выпуска
- Краткие характеристики: мощность, разгон 0-100, тип двигателя

#### FR-2.2: Фильтрация
Система должна поддерживать фильтрацию по:
- Марке (множественный выбор)
- Типу кузова (множественный выбор)
- Диапазону цен (слайдер от-до в рублях)
- Мощности (слайдер от-до)
- Типу привода (передний, задний, полный)
- Типу двигателя (электро, бензин, гибрид)

Фильтры должны:
- Применяться мгновенно через клиентский JavaScript
- Обновлять счетчик найденных автомобилей
- Сохранять состояние в URL (query params) для возможности шаринга

#### FR-2.3: Поиск
Должен быть реализован поиск по названию марки и модели с автодополнением.

#### FR-2.4: Сортировка
Пользователь должен иметь возможность сортировать каталог:
- По цене (возрастание/убывание)
- По мощности (возрастание/убывание)
- По году (новые/старые)
- По названию (A-Z)

#### FR-2.5: Ленивая загрузка
Каталог должен использовать ленивую загрузку (infinite scroll):
- Начальная загрузка: 12 автомобилей
- При скролле к концу списка: подгружать следующие 12
- Показывать индикатор загрузки

### FR-3: Страница конфигуратора

#### FR-3.1: Структура страницы
Страница конфигуратора должна содержать:
1. **Левая часть (60% ширины)**:
   - Крупное изображение автомобиля (обновляется при изменении параметров)
   - Галерея миниатюр (экстерьер, салон, детали)

2. **Правая часть (40% ширины)**:
   - Название: "{Марка} {Модель}"
   - Селектор модификации (L7 Pro, L7 Max, L7 Ultra)
   - Селектор цвета кузова (визуальные кружки с цветами)
   - Селектор дисков (визуальные превью)
   - Селектор интерьера (визуальные превью)
   - Список дополнительных опций (чекбоксы с описанием и ценой)
   - Блок итоговой цены (одновременно в рублях и юанях)
   - Кнопка "Оставить заявку"

3. **Нижняя часть**:
   - Аккордеон с полными техническими характеристиками
   - Разделы: Двигатель, Трансмиссия, Подвеска, Размеры, Безопасность

#### FR-3.2: Логика смены изображений
При изменении параметров конфигурации:
- **Смена модификации**: обновляется основное изображение, цена, характеристики, доступные опции
- **Смена цвета**: обновляется изображение экстерьера с плавной анимацией (fade, 300ms)
- **Смена дисков**: обновляется изображение экстерьера
- **Смена интерьера**: обновляется изображение салона в галерее

#### FR-3.3: Расчет итоговой цены
Итоговая цена рассчитывается как:
```
Итоговая цена = Базовая цена модификации 
                + Доплата за цвет (если есть)
                + Доплата за диски (если есть)
                + Доплата за интерьер (если есть)
                + Сумма всех выбранных платных опций
```

Цена отображается одновременно в двух валютах:
```
3 450 000 ₽ / 312 000 ¥
```

#### FR-3.4: Курс валют
Система должна:
- Ежедневно получать курс юаня к рублю через API ЦБ РФ
- Сохранять курс в таблице `currency_rates`
- Предоставлять возможность ручной корректировки курса в админке
- При ручной корректировке помечать запись `is_manual_override = true`
- Использовать последний актуальный курс для всех расчетов

#### FR-3.5: Адаптивность
Конфигуратор должен быть полностью адаптивным:
- **Desktop (1280px+)**: двухколоночная раскладка (изображение слева, параметры справа)
- **Tablet (768px-1279px)**: двухколоночная раскладка с уменьшенными отступами
- **Mobile (<768px)**: одноколоночная раскладка, изображение сверху, параметры снизу

### FR-4: Форма заявки

#### FR-4.1: Поля формы
Форма должна содержать обязательные поля:
- Имя (текст, минимум 2 символа)
- Телефон (с маской ввода, валидация международных номеров)
- Email (валидация формата email)

#### FR-4.2: Валидация
- Все поля обязательны для заполнения
- Телефон: поддержка форматов РФ и международных (+7, +86, +82, +81, +1, etc.)
- Email: стандартная валидация через regex
- Показывать ошибки валидации под соответствующими полями

#### FR-4.3: Отправка заявки
При отправке формы:
1. Валидировать все поля
2. Собрать полную конфигурацию в объект `configuration_snapshot`:
```json
{
  "brand": "Lixiang",
  "model": "L7",
  "trim": "L7 Max",
  "color": {
    "id": "uuid",
    "name": "Синий металлик",
    "hex": "#1E3A8A",
    "image_url": "/uploads/..."
  },
  "wheels": {
    "id": "uuid",
    "name": "20\" Спорт",
    "image_url": "/uploads/..."
  },
  "interior": {
    "id": "uuid",
    "name": "Черная кожа Nappa",
    "image_url": "/uploads/..."
  },
  "additional_options": [
    {
      "id": "uuid",
      "name": "Автопилот Level 2",
      "price_cny": 15000,
      "price_rub": 165000
    }
  ],
  "total_price_cny": 312000,
  "total_price_rub": 3450000
}
```
3. Сохранить заявку в БД со статусом "new"
4. Отправить email клиенту с подтверждением
5. Отправить уведомление менеджерам
6. Показать модальное окно с успешным сообщением

#### FR-4.4: Email уведомления
**Клиенту**:
- Тема: "Ваша заявка на {Марка} {Модель} принята"
- Содержание: данные конфигурации, контакты компании, сообщение о звонке менеджера

**Менеджерам**:
- Тема: "Новая заявка #{ID}"
- Содержание: все данные клиента и конфигурации, ссылка на CRM для просмотра

### FR-5: Статусы заявок

#### FR-5.1: Жизненный цикл заявки
Заявка должна поддерживать следующие статусы:
- `new` - Новая (при создании)
- `in_progress` - В обработке (менеджер начал работу)
- `completed` - Завершена (сделка закрыта или отказ)
- `cancelled` - Отменена (клиент отказался)

#### FR-5.2: Переходы статусов
Статусы меняются только менеджером в CRM системе.
Должна вестись история изменений статусов с timestamps.

### FR-6: Оптимизация и производительность

#### FR-6.1: Оптимизация изображений
Все загружаемые изображения должны:
- Конвертироваться в WebP формат (с fallback на JPEG)
- Генерировать несколько размеров (thumbnail, medium, large)
- Использовать Next.js Image component с автоматической оптимизацией
- Применять lazy loading для всех изображений
- Использовать blur placeholder при загрузке

#### FR-6.2: Кэширование
- Данные каталога кэшируются на стороне клиента (React Query / SWR)
- Time to live (TTL): 5 минут
- Invalidация кэша при обновлении данных в админке

#### FR-6.3: SEO
- Уникальные meta tags для каждой модели
- Structured data (JSON-LD) для автомобилей
- Правильные заголовки H1-H6
- Alt текст для всех изображений

## 5. Non-Goals (Out of Scope)

Следующие функции **не включены** в текущую версию:

1. **Сравнение автомобилей**: будет добавлено в следующей итерации
2. **Б/У автомобили**: текущая версия только для новых автомобилей
3. **Онлайн оплата**: заявки обрабатываются менеджерами, оплата отдельно
4. **Личный кабинет пользователя**: пока не требуется
5. **Мобильное приложение**: только веб-версия
6. **3D визуализация**: используются статичные изображения
7. **Виртуальный тест-драйв**: не входит в MVP
8. **Интеграция с внешними CRM**: будет реализовано позже
9. **Чат с менеджером**: пока только форма заявки
10. **История просмотров**: не требуется в первой версии

## 6. Design Considerations

### 6.1: Цветовая схема
Использовать фирменные цвета компании Филмаш:
- Основной желтый: `#CFF902`
- Основной синий: `#4380C2`
- Дополнительные цвета: серые оттенки для текста и фонов

### 6.2: UI библиотеки и компоненты
Проект должен использовать:
- **shadcn/ui**: для базовых компонентов (Button, Input, Select, Dialog, Accordion)
- **Radix UI**: для доступных примитивов
- **Lucide Icons**: для иконок
- **Framer Motion**: для анимаций
- **Tailwind CSS**: для стилизации

### 6.3: Типография
- Заголовки: Inter или Manrope (bold)
- Основной текст: Inter (regular/medium)
- Размеры: следовать scale от shadcn/ui

### 6.4: Анимации
- Смена изображений: fade transition (300ms, ease-in-out)
- Смена цены: counter animation с плавным изменением
- Открытие модальных окон: scale + fade (200ms)
- Hover эффекты на кнопках и карточках: subtle scale (150ms)

### 6.5: Макеты
Референс: https://filmash.ru/catalog и https://filmash.ru/catalog/Lixiang/l7/

Но с улучшениями:
- Более чистые карточки в каталоге
- Улучшенная визуальная иерархия в конфигураторе
- Более крупные изображения
- Лучшая читаемость технических характеристик

## 7. Technical Considerations

### 7.1: Stack технологий
- **Frontend**: Next.js 14+ (App Router), React 18+, TypeScript
- **Styling**: Tailwind CSS, shadcn/ui, Radix UI
- **Animations**: Framer Motion
- **Forms**: React Hook Form + Zod validation
- **State Management**: React Query / SWR для серверного состояния, Zustand для клиентского
- **Backend**: Next.js API Routes
- **Database**: PostgreSQL 15+
- **ORM**: Prisma или Drizzle ORM
- **Image Storage**: Локальное хранилище на сервере (можно мигрировать на S3/CDN позже)
- **Email**: Nodemailer или Resend
- **API для курсов валют**: API ЦБ РФ (1. Подключаете этот скрипт со встроенной библиотекой money.js. <script src="https://www.cbr-xml-daily.ru/money.js"></script> Конвертируете из любой валюты в любую по курсам ЦБ РФ. fx(100).from("CNY").to("RUB"))

### 7.2: Архитектурные решения
- Использовать серверные компоненты Next.js где возможно
- API routes для мутаций (создание заявок, обновление данных)
- Оптимистичные обновления UI при отправке форм
- Debounce для фильтров и поиска (300ms)

### 7.3: Безопасность
- Валидация всех входных данных на сервере
- SQL injection защита через ORM
- Rate limiting для API endpoints (особенно форма заявки)
- CSRF токены для форм
- Sanitization пользовательского ввода

### 7.4: Производительность
- Code splitting по роутам
- Dynamic imports для тяжелых компонентов
- Image optimization через Next.js Image
- Минификация и сжатие ассетов
- CDN для статики (в будущем)

### 7.5: Миграции БД
Использовать Prisma Migrate для управления схемой БД:
- Версионирование миграций
- Rollback возможность
- Seed данные для разработки

## 8. Success Metrics

Успех фичи будет измеряться по следующим метрикам:

1. **Конверсия**: 
   - Процент посетителей каталога, открывших конфигуратор: целевой показатель >40%
   - Процент пользователей конфигуратора, отправивших заявку: целевой показатель >15%

2. **Вовлеченность**:
   - Среднее время на странице конфигуратора: целевой показатель >3 минуты
   - Среднее количество изменений конфигурации: целевой показатель >5 действий

3. **Производительность**:
   - Время загрузки каталога (LCP): <2.5 секунды
   - Время загрузки конфигуратора (LCP): <2.5 секунды
   - Плавность анимаций: 60 FPS

4. **Качество заявок**:
   - Процент заявок с полностью заполненными конфигурациями: >95%
   - Процент заявок, переходящих в статус "completed": целевой показатель >30%

5. **UX метрики**:
   - Показатель отказов (bounce rate) на каталоге: <40%
   - Процент мобильных пользователей: отслеживание для будущих улучшений

## 9. Open Questions

1. **Мультиязычность**: Планируется ли поддержка английского/китайского языков?
   - *Решение отложено на последующие итерации*

2. **Аналитика**: Какую систему аналитики использовать (Google Analytics, Yandex Metrica, Mixpanel)?
   - *Требуется решение команды*

3. **Backup стратегия**: Как часто делать бэкапы БД и где хранить?
   - *Требуется решение DevOps команды*

4. **Хостинг изображений**: Остаться на локальном хранилище или мигрировать на CDN (Cloudflare, AWS S3)?
   - *Начать с локального, при необходимости мигрировать*

5. **Уведомления менеджеров**: Только email или также Telegram/Slack интеграция?
   - *Требуется решение команды*

6. **Тестовые данные**: Сколько автомобилей нужно добавить для первоначального запуска?
   - *Рекомендуется минимум 15-20 моделей для демонстрации функционала*

7. **API Rate Limiting**: Какие лимиты установить для формы заявки? (предложение: 3 заявки в час с одного IP)
   - *Требуется согласование*

8. **Обработка ошибок API курсов валют**: Что делать если API ЦБ недоступен?
   - *Использовать последний сохраненный курс + логировать ошибку*

---

**Дата создания**: 2026-02-03  
**Версия**: 1.0  
**Статус**: Draft - требуется review команды
