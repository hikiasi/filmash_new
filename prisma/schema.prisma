// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Brand {
  id                String   @id @default(uuid()) @db.Uuid
  name              String
  logo_url          String
  country_of_origin String
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt
  models            Model[]
}

model Model {
  id          String   @id @default(uuid()) @db.Uuid
  brand_id    String   @db.Uuid
  name        String
  body_type   String
  year        Int
  description String
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  brand Brand  @relation(fields: [brand_id], references: [id])
  trims Trim[]

  @@index([brand_id])
}

model Trim {
  id                  String               @id @default(uuid()) @db.Uuid
  model_id            String               @db.Uuid
  name                String
  base_price_cny      Decimal
  base_price_rub      Decimal
  specifications      Json
  created_at          DateTime             @default(now())
  updated_at          DateTime             @updatedAt
  model               Model                @relation(fields: [model_id], references: [id])
  colors              Color[]
  wheels              Wheel[]
  interiors           Interior[]
  steering_wheels     SteeringWheel[]
  additional_options  AdditionalOption[]
  inquiries           Inquiry[]
  config_images       ConfigurationImage[]

  @@index([model_id])
}

model Color {
  id                   String               @id @default(uuid()) @db.Uuid
  trim_id              String               @db.Uuid
  name                 String
  hex_code             String
  image_url            String // Thumbnail/Icon
  is_premium           Boolean
  additional_price_cny Decimal?
  additional_price_rub Decimal?
  created_at           DateTime             @default(now())
  trim                 Trim                 @relation(fields: [trim_id], references: [id])
  inquiries            Inquiry[]
  config_images        ConfigurationImage[]

  @@index([trim_id])
}

model Wheel {
  id                   String               @id @default(uuid()) @db.Uuid
  trim_id              String               @db.Uuid
  name                 String
  size                 String
  image_url            String // Thumbnail/Icon
  additional_price_cny Decimal?
  additional_price_rub Decimal?
  created_at           DateTime             @default(now())
  trim                 Trim                 @relation(fields: [trim_id], references: [id])
  inquiries            Inquiry[]
  config_images        ConfigurationImage[]

  @@index([trim_id])
}

model Interior {
  id                   String               @id @default(uuid()) @db.Uuid
  trim_id              String               @db.Uuid
  name                 String
  material             String
  image_url            String // Background/Inside view
  additional_price_cny Decimal?
  additional_price_rub Decimal?
  created_at           DateTime             @default(now())
  trim                 Trim                 @relation(fields: [trim_id], references: [id])
  inquiries            Inquiry[]
  config_images        ConfigurationImage[]

  @@index([trim_id])
}

model SteeringWheel {
  id                   String               @id @default(uuid()) @db.Uuid
  trim_id              String               @db.Uuid
  name                 String
  image_url            String // Icon
  additional_price_cny Decimal?
  additional_price_rub Decimal?
  created_at           DateTime             @default(now())
  trim                 Trim                 @relation(fields: [trim_id], references: [id])
  config_images        ConfigurationImage[]

  @@index([trim_id])
}

model ConfigurationImage {
  id                String  @id @default(uuid()) @db.Uuid
  trim_id           String  @db.Uuid
  color_id          String? @db.Uuid
  wheel_id          String? @db.Uuid
  interior_id       String? @db.Uuid
  steering_wheel_id String? @db.Uuid
  image_url         String
  type              String  // 'exterior', 'interior'

  trim           Trim           @relation(fields: [trim_id], references: [id])
  color          Color?         @relation(fields: [color_id], references: [id])
  wheel          Wheel?         @relation(fields: [wheel_id], references: [id])
  interior       Interior?      @relation(fields: [interior_id], references: [id])
  steering_wheel SteeringWheel? @relation(fields: [steering_wheel_id], references: [id])

  @@index([trim_id])
  @@index([color_id])
  @@index([wheel_id])
  @@index([interior_id])
  @@index([steering_wheel_id])
}

model AdditionalOption {
  id          String   @id @default(uuid()) @db.Uuid
  trim_id     String   @db.Uuid
  name        String
  description String
  is_paid     Boolean
  price_cny   Decimal?
  price_rub   Decimal?
  category    String
  created_at  DateTime @default(now())
  trim        Trim     @relation(fields: [trim_id], references: [id])

  @@index([trim_id])
}

model Inquiry {
  id                     String    @id @default(uuid()) @db.Uuid
  trim_id                String    @db.Uuid
  color_id               String    @db.Uuid
  wheels_id              String?   @db.Uuid
  interior_id            String?   @db.Uuid
  selected_options       Json
  customer_name          String
  customer_phone         String
  customer_email         String
  total_price_cny        Decimal
  total_price_rub        Decimal
  status                 String // ENUM equivalent: 'new', 'in_progress', 'completed', 'cancelled'
  configuration_snapshot Json
  notes                  String?
  created_at             DateTime  @default(now())
  updated_at             DateTime  @updatedAt
  trim                   Trim      @relation(fields: [trim_id], references: [id])
  color                  Color     @relation(fields: [color_id], references: [id])
  wheels                 Wheel?    @relation(fields: [wheels_id], references: [id])
  interior               Interior? @relation(fields: [interior_id], references: [id])

  @@index([trim_id])
  @@index([color_id])
  @@index([wheels_id])
  @@index([interior_id])
  @@index([status])
}

model CurrencyRate {
  id                 String   @id @default(uuid()) @db.Uuid
  rate_cny_to_rub    Decimal
  source             String
  is_manual_override Boolean
  valid_from         DateTime
  created_at         DateTime @default(now())
}
